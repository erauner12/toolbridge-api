apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "toolbridge-mcp.fullname" . }}-config
  labels:
    {{- include "toolbridge-mcp.labels" . | nindent 4 }}
data:
  # Server configuration
  TOOLBRIDGE_HOST: {{ .Values.mcp.host | quote }}
  TOOLBRIDGE_PORT: {{ .Values.mcp.port | quote }}
  TOOLBRIDGE_LOG_LEVEL: {{ .Values.mcp.logLevel | quote }}

  # WorkOS AuthKit configuration (REQUIRED)
  TOOLBRIDGE_AUTHKIT_DOMAIN: {{ .Values.mcp.authkit.domain | required "mcp.authkit.domain is required for WorkOS AuthKit authentication" | quote }}

  # Public URL (required for OAuth metadata)
  {{- $publicUrl := .Values.mcp.publicBaseUrl | default (printf "https://%s" .Values.ingress.hostname) }}
  TOOLBRIDGE_PUBLIC_BASE_URL: {{ $publicUrl | required "mcp.publicBaseUrl or ingress.hostname is required for OAuth metadata" | quote }}

  # Backend API configuration
  TOOLBRIDGE_GO_API_BASE_URL: {{ .Values.mcp.backend.baseUrl | quote }}
  TOOLBRIDGE_BACKEND_API_AUDIENCE: {{ .Values.mcp.backend.audience | quote }}

  # UI configuration
  TOOLBRIDGE_UI_HTML_MIME_TYPE: {{ .Values.mcp.uiHtmlMimeType | quote }}

  # Graceful shutdown
  TOOLBRIDGE_SHUTDOWN_TIMEOUT_SECONDS: {{ .Values.mcp.shutdownTimeoutSeconds | quote }}
