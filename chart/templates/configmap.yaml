apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "toolbridge-api.fullname" . }}-config
  labels:
    {{- include "toolbridge-api.labels" . | nindent 4 }}
data:
  ENV: {{ .Values.api.env | quote }}
  HTTP_ADDR: {{ .Values.api.httpAddr | quote }}
  {{- if .Values.grpc.enabled }}
  GRPC_ADDR: {{ .Values.grpc.addr | quote }}
  {{- end }}
  DB_HOST: {{ .Values.config.dbHost | default (include "toolbridge-api.database.serviceName" .) | quote }}
  DB_PORT: {{ .Values.config.dbPort | quote }}
  DB_NAME: {{ .Values.config.dbName | quote }}
  DB_USER: {{ .Values.config.dbUser | quote }}
  DB_SSLMODE: {{ .Values.config.dbSslMode | quote }}
  {{- if .Values.api.jwt }}
  {{- if .Values.api.jwt.issuer }}
  JWT_ISSUER: {{ .Values.api.jwt.issuer | quote }}
  {{- end }}
  {{- if .Values.api.jwt.jwksUrl }}
  JWT_JWKS_URL: {{ .Values.api.jwt.jwksUrl | quote }}
  {{- end }}
  {{- if .Values.api.jwt.audience }}
  JWT_AUDIENCE: {{ .Values.api.jwt.audience | quote }}
  {{- end }}
  {{- if .Values.api.jwt.tenantClaim }}
  TENANT_CLAIM: {{ .Values.api.jwt.tenantClaim | quote }}
  {{- end }}
  {{- end }}
  {{- if .Values.api.mcp.enabled }}
  MCP_OAUTH_AUDIENCE: {{ .Values.api.mcp.oauthAudience | default "" | quote }}
  {{- end }}
