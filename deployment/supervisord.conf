[supervisord]
nodaemon=true
user=app
logfile=/dev/stdout
logfile_maxbytes=0
loglevel=info
pidfile=/tmp/supervisord.pid

[program:toolbridge-api]
command=/app/toolbridge-api
autostart=true
autorestart=true
startsecs=5
startretries=3
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=HTTP_ADDR=":8080"
priority=10

[program:toolbridge-mcp]
command=uvicorn toolbridge_mcp.server:mcp --host 0.0.0.0 --port 8001 --log-level info
directory=/app/mcp
autostart=true
autorestart=true
startsecs=5
startretries=3
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=20

# Ensure Go API starts before MCP service (dependency)
[group:toolbridge]
programs=toolbridge-api,toolbridge-mcp
priority=10
